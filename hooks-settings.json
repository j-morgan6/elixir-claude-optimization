{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "EXT=\"${CLAUDE_HOOK_FILE_PATH##*.}\"; if [ \"$EXT\" = \"ex\" ] || [ \"$EXT\" = \"exs\" ] || [ \"$EXT\" = \"heex\" ]; then echo 'üí° Reminder: Did you invoke the relevant elixir-phoenix-guide skill before writing this file? If not, invoke it now and verify your code follows the rules.'; fi; exit 0",
            "description": "Remind about skill invocation for Elixir files"
          },
          {
            "type": "command",
            "command": "FILTERED=$(grep -v '^\\s*#' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null); if echo \"$FILTERED\" | grep -qE 'def\\s+(mount|handle_event|handle_info|handle_call|handle_cast|render|init|terminate)\\(' && ! echo \"$FILTERED\" | grep -B1 'def\\s\\+(mount|handle_event|handle_info|handle_call|handle_cast|render|init|terminate)\\(' | grep -q '@impl'; then echo '‚ö†Ô∏è  Missing @impl true before callback function. Add @impl true before mount, handle_event, handle_info, handle_call, handle_cast, render, init, or terminate callbacks.' && exit 2; fi",
            "description": "Block callbacks without @impl true (ignores comments)"
          },
          {
            "type": "command",
            "command": "if grep -qE '(upload_path|file_path|uploads_dir)\\s*=\\s*[\"'\\''](/|priv/)' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then echo 'üö´ Hardcoded file path detected. Use Application.get_env(:app, :config_key) instead.' && exit 2; fi",
            "description": "Block hardcoded file paths"
          },
          {
            "type": "command",
            "command": "if grep -qE '(max_file_size|file_size_limit|max_upload|max_size)\\s*=\\s*[0-9]{7,}' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then echo 'üö´ Hardcoded file size limit detected (7+ digits). Move to Application config.' && exit 2; fi",
            "description": "Block hardcoded file size limits"
          },
          {
            "type": "command",
            "command": "COLLAPSED=$(tr '\\n' ' ' < \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null); if echo \"$COLLAPSED\" | grep -qE 'if\\s+[^d]+\\s+do\\s+[^e]*if\\s+[^d]+\\s+do'; then echo '‚ö†Ô∏è  Nested if/else detected. Consider using pattern matching or case statements for more idiomatic Elixir.' && exit 1; fi",
            "description": "Warn on nested if/else (handles multiline)"
          },
          {
            "type": "command",
            "command": "COLLAPSED=$(tr '\\n' ' ' < \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null); if echo \"$COLLAPSED\" | grep -qE '\\|>\\s*Enum\\.(map|filter)\\([^)]+\\)\\s*\\|>\\s*Enum\\.(map|filter)\\('; then echo '‚ö†Ô∏è  Multiple Enum operations detected. Consider using a for comprehension or Enum.reduce for better performance.' && exit 1; fi",
            "description": "Warn on inefficient Enum chains (handles multiline)"
          },
          {
            "type": "command",
            "command": "if grep -qE 'Enum\\.(map|reduce|each).*<>' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then echo '‚ö†Ô∏è  String concatenation with <> in Enum operations. Consider using IO lists or Enum.join for better performance.' && exit 1; fi",
            "description": "Warn on string concatenation in loops"
          },
          {
            "type": "command",
            "command": "if grep -qE 'def static_paths' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then PATHS=$(grep -A10 'def static_paths' \"$CLAUDE_HOOK_FILE_PATH\" | grep -oE '\"[^\"]+\"' | tr -d '\"' | tr '\\n' ' '); REFS=$(grep -hoE '/[a-z_]+/' \"$CLAUDE_HOOK_FILE_PATH\" | sort -u | tr -d '/' | tr '\\n' ' '); for ref in $REFS; do echo \" $PATHS \" | grep -qw \"$ref\" || echo \"‚ö†Ô∏è  Path reference '/$ref/' found but '$ref' not in static_paths(). Add to lib/my_app_web.ex: def static_paths, do: ~w(assets $ref favicon.ico)\" && exit 2; done; fi",
            "description": "Block file path references not in static_paths"
          },
          {
            "type": "command",
            "command": "if grep -qE '<\\.(flash_group|flash)' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then echo 'üö´ .flash_group component is deprecated in Phoenix 1.8+. Flash handling is now automatic in layouts. Remove <.flash_group> calls.' && exit 2; fi; if grep -qE 'form_for\\(' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then echo 'üö´ form_for is deprecated. Use <.form for={to_form(@changeset)}> instead.' && exit 2; fi; if grep -qE 'live_redirect|live_patch' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then echo 'üö´ live_redirect/live_patch are deprecated. Use <.link navigate={path}> or push_navigate/push_patch instead.' && exit 2; fi",
            "description": "Block deprecated Phoenix components and functions"
          },
          {
            "type": "command",
            "command": "if grep -qE 'auto_upload:\\s*true' \"$CLAUDE_HOOK_FILE_PATH\" 2>/dev/null; then echo '‚ö†Ô∏è  auto_upload: true detected. This requires special handling with handle_progress/3. Most apps should use manual upload (remove auto_upload: true and add a submit button). See phoenix-uploads skill for details.' && exit 1; fi",
            "description": "Warn on auto_upload usage"
          }
        ]
      }
    ]
  }
}
